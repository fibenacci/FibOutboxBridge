<sw-page class="fib-outbox-routing">
    <template #smart-bar-header>
        <h2>{{ $tc('fib-outbox-bridge.routing.title') }}</h2>
    </template>

    <template #smart-bar-actions>
        <sw-button variant="ghost" @click="loadAll" :is-loading="isLoading">
            {{ $tc('fib-outbox-bridge.routing.actions.refresh') }}
        </sw-button>
        <sw-button variant="primary" @click="openCreateTargetModal">
            {{ $tc('fib-outbox-bridge.routing.actions.addTarget') }}
        </sw-button>
    </template>

    <template #content>
        <sw-card-view>
            <sw-card :title="$tc('fib-outbox-bridge.routing.targets.title')">
                <sw-data-grid
                    :data-source="targets"
                    :columns="targetColumns"
                    :is-loading="isLoading"
                    :allow-inline-edit="false"
                    :show-actions="true"
                >
                    <template #column-isActive="{ item }">
                        <sw-label appearance="pill" :variant="item.isActive ? 'success' : 'danger'">
                            {{ item.isActive ? $tc('fib-outbox-bridge.routing.common.active') : $tc('fib-outbox-bridge.routing.common.inactive') }}
                        </sw-label>
                    </template>

                    <template #actions="{ item }">
                        <sw-context-menu-item @click="openEditTargetModal(item)">
                            {{ $tc('fib-outbox-bridge.routing.actions.edit') }}
                        </sw-context-menu-item>
                        <sw-context-menu-item variant="danger" @click="deleteTarget(item)">
                            {{ $tc('fib-outbox-bridge.routing.actions.delete') }}
                        </sw-context-menu-item>
                    </template>
                </sw-data-grid>
            </sw-card>
        </sw-card-view>

        <sw-modal v-if="showTargetModal" :title="targetModalTitle" @modal-close="closeTargetModal">
            <sw-text-field
                v-model:value="targetDraft.name"
                :label="$tc('fib-outbox-bridge.routing.targets.fields.name')"
                required
            />
            <sw-text-field
                v-model:value="targetDraft.technicalName"
                :label="$tc('fib-outbox-bridge.routing.targets.fields.technicalName')"
                :help-text="$tc('fib-outbox-bridge.routing.targets.fields.technicalNameHelp')"
                required
                :disabled="isEditingTarget"
            />
            <sw-single-select
                v-model:value="targetDraft.type"
                :label="$tc('fib-outbox-bridge.routing.targets.fields.type')"
                :options="targetTypeOptions"
                label-property="label"
                value-property="value"
            />
            <sw-switch-field
                v-model:value="targetDraft.isActive"
                :label="$tc('fib-outbox-bridge.routing.targets.fields.isActive')"
            />
            <sw-alert variant="info" appearance="default" :title="$tc('fib-outbox-bridge.routing.targets.security.title')">
                {{ $tc('fib-outbox-bridge.routing.targets.security.hint') }}
            </sw-alert>

            <template v-for="field in configFieldDefinitions" :key="field.name">
                <sw-switch-field
                    v-if="field.type === 'bool'"
                    v-model:value="targetDraft.config[field.name]"
                    :label="field.label"
                />
                <sw-textarea-field
                    v-else-if="field.type === 'textarea'"
                    v-model:value="targetDraft.config[field.name]"
                    :label="field.label"
                    :placeholder="field.placeholder"
                    :help-text="getConfigFieldHelpText(field)"
                />
                <sw-text-field
                    v-else
                    v-model:value="targetDraft.config[field.name]"
                    :label="field.label"
                    :placeholder="field.placeholder"
                    :help-text="getConfigFieldHelpText(field)"
                />
            </template>

            <template #modal-footer>
                <sw-button variant="ghost" @click="closeTargetModal">
                    {{ $tc('fib-outbox-bridge.routing.actions.cancel') }}
                </sw-button>
                <sw-button variant="primary" @click="saveTarget" :is-loading="saveLoading">
                    {{ $tc('fib-outbox-bridge.routing.actions.save') }}
                </sw-button>
            </template>
        </sw-modal>
    </template>
</sw-page>
